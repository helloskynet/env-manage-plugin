[![npm][npm]][npm-url]
[![node][node]][node-url]
![npm](https://img.shields.io/npm/dw/env-manage-plugin.svg)

# EnvManage - ç¯å¢ƒç®¡ç†å·¥å…·

`EnvManage` æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ç¯å¢ƒç®¡ç†å·¥å…·ï¼Œä¸“ä¸ºç®¡ç†å’Œä»£ç†å¤šä¸ªå¼€å‘ç¯å¢ƒè€Œè®¾è®¡ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦åŒæ—¶è¿è¡Œå¤šä¸ªå¼€å‘ç¯å¢ƒçš„åœºæ™¯ã€‚æ— è®ºæ˜¯å°å‹é¡¹ç›®è¿˜æ˜¯å¤§å‹ä¼ä¸šçº§åº”ç”¨ï¼Œ`EnvManage` éƒ½èƒ½æå¤§åœ°æå‡å¼€å‘æ•ˆç‡ï¼Œç®€åŒ–ç¯å¢ƒç®¡ç†æµç¨‹ã€‚

```mermaid
graph LR
    A[å‰ç½®è½¬å‘æœåŠ¡1<br>ç«¯å£ 3000] -->|æ·»åŠ æ ‡å¿—ä½ x-api-server: 1| B[å¼€å‘æœåŠ¡å™¨<br>ç«¯å£ 8080]
    C[å‰ç½®è½¬å‘æœåŠ¡2<br>ç«¯å£ 3001] -->|æ·»åŠ æ ‡å¿—ä½ x-api-server: 2| B
    B --> D[åç½®è½¬å‘æœåŠ¡<br>ç«¯å£ 3099]
    D -->|x-api-server: 1| E[API æœåŠ¡å™¨1]
    D -->|x-api-server: 2| F[API æœåŠ¡å™¨2]
```

## ğŸŒŸåŠŸèƒ½ç‰¹æ€§

- **åŠ¨æ€ç¯å¢ƒç®¡ç†**

  é€šè¿‡ç®€å•çš„é…ç½®æ–‡ä»¶ `env.config.js`ï¼Œæ‚¨å¯ä»¥è½»æ¾å®šä¹‰å’Œç®¡ç†å¤šä¸ªå¼€å‘ç¯å¢ƒã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæ‚¨èƒ½çµæ´»è®¾ç½®ä¸åŒç¯å¢ƒçš„åç§°ã€ç«¯å£ã€ç›®æ ‡æœåŠ¡å™¨åœ°å€ç­‰å…³é”®ä¿¡æ¯ï¼Œå®ç°å¯¹å„ä¸ªå¼€å‘ç¯å¢ƒçš„ç²¾å‡†åŒºåˆ†ä¸é«˜æ•ˆç®¡ç†ã€‚

- **è¯·æ±‚ä»£ç†**

  æ”¯æŒå‰ç½®å’Œåç½®ä»£ç†ï¼Œç¡®ä¿è¯·æ±‚å‡†ç¡®æ— è¯¯åœ°è½¬å‘åˆ°æŒ‡å®šçš„å¼€å‘æœåŠ¡å™¨ã€‚ä»£ç†æœåŠ¡å™¨ä¼šä¾æ®é…ç½®çš„ç›®æ ‡æœåŠ¡å™¨åœ°å€ï¼Œå°†è¯·æ±‚ç²¾å‡†è½¬å‘åˆ°å¯¹åº”çš„ API æœåŠ¡å™¨ï¼Œä¿éšœæ•°æ®äº¤äº’é¡ºç•…ã€‚

- **é…ç½®æ–‡ä»¶çƒ­æ›´æ–°**

  æ— éœ€ç¹ççš„é‡å¯æœåŠ¡æ“ä½œï¼Œ`EnvManage` æ”¯æŒé…ç½®æ–‡ä»¶çƒ­æ›´æ–°ã€‚å½“æ‚¨å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹åï¼Œå·¥å…·ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åº”ç”¨æ–°çš„é…ç½®ï¼Œæ˜¾è‘—æé«˜å¼€å‘æ•ˆç‡ï¼Œè®©æ‚¨çš„å¼€å‘è¿‡ç¨‹æ›´åŠ æµç•…ã€‚

- **å¤šæœåŠ¡å™¨ç®¡ç†**

  è½»æ¾å®ç°åŒæ—¶å¯åŠ¨å’Œç®¡ç†å¤šä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡ç®¡ç†é¡µé¢æŸ¥çœ‹ä»£ç†æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼ŒåŒæ—¶å¯çµæ´»å¯åŠ¨æˆ–åœæ­¢æŸä¸ªç¯å¢ƒå¯¹åº”çš„æœåŠ¡å™¨ã€‚

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### å®‰è£…

```bash
npm i -D envmange
```

æˆ–è€…å…¨å±€å®‰è£…

```bash
npm i -g envmange
```

### é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `env.config.js` æ–‡ä»¶ï¼Œæ ¹æ®å®é™…éœ€æ±‚å®šä¹‰å¼€å‘ç¯å¢ƒå’Œå¼€å‘æœåŠ¡å™¨åˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯å„é…ç½®å±æ€§çš„è¯¦ç»†è¯´æ˜

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**

```js
// env.config.js  æ”¯æŒCommonJS å’Œ ES Module
export default {
  // ç®¡ç†æœåŠ¡å™¨è¿è¡Œçš„ç«¯å£ï¼Œå¯æ ¹æ®å®é™…éœ€æ±‚ä¿®æ”¹ï¼Œç¡®ä¿è¯¥ç«¯å£æœªè¢«å…¶ä»–ç¨‹åºå ç”¨
  port: 3099,
  // åŸºç¡€è·¯å¾„ï¼Œç”¨äºæ„å»ºAPIè¯·æ±‚çš„å‰ç¼€ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†å’Œè¯†åˆ«ä¸EnvManageç›¸å…³çš„æ¥å£è¯·æ±‚
  basePath: "/dev-manage-api",
  // ç¯å¢ƒçš„ç´¢å¼•è·¯å¾„ï¼Œå¯ä½œä¸ºç¯å¢ƒçš„é¦–é¡µè·¯å¾„æˆ–ç‰¹å®šçš„å…¥å£è·¯å¾„ï¼Œå¯ä»¥è¢« envList ä¸­çš„è¦†ç›–
  indexPage: "/Test",
  devServerList: [
    {
      // ä¸ºå¼€å‘æœåŠ¡å™¨å‘½åï¼Œä¾¿äºè¯†åˆ«å’Œç®¡ç†ï¼Œåç§°å¯è‡ªå®šä¹‰
      // prima key
      name: "your_dev_server_1",
      // è¯¥å¼€å‘æœåŠ¡å™¨å¯¹åº”çš„ç›®æ ‡åœ°å€ï¼Œå³å®é™…æä¾›æœåŠ¡çš„åœ°å€
      target: "http://localhost:5173",
    },
    // å¯ä»¥æ·»åŠ æ›´å¤šå¼€å‘æœåŠ¡å™¨
  ],
  envList: [
    {
      // ä¸ºå¼€å‘ç¯å¢ƒå‘½åï¼Œå¦‚å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒç­‰ï¼Œæ–¹ä¾¿åŒºåˆ†
      // prima key
      name: "your_env_1",
      // è¯¥ç¯å¢ƒå¯¹å¤–æš´éœ²çš„ç«¯å£ï¼Œç”¨äºè®¿é—®è¯¥ç¯å¢ƒä¸‹çš„åº”ç”¨
      // prima key
      port: 3000,
      // è¯¥ç¯å¢ƒè¯·æ±‚è½¬å‘çš„ç›®æ ‡æœåŠ¡å™¨åœ°å€ï¼Œé€šå¸¸æ˜¯åç«¯ API æœåŠ¡åœ°å€
      target: "http://localhost:3010",
      // ç¯å¢ƒçš„ç´¢å¼•è·¯å¾„ï¼Œå¯ä½œä¸ºè¯¥ç¯å¢ƒçš„é¦–é¡µè·¯å¾„æˆ–ç‰¹å®šçš„å…¥å£è·¯å¾„
      indexPage: "/Test",
      // å…³è”çš„å¼€å‘æœåŠ¡å™¨ ID  å³ç´¢å¼•
      devServerId: "0",
      // è·¯ç”±è§„åˆ™å‡½æ•°ï¼Œæ ¹æ®è¯·æ±‚å’Œç¯å¢ƒä¿¡æ¯ï¼Œè¿”å›è¯·æ±‚åº”è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€
      // è‡ªå®šä¹‰ ç›®æ ‡åœ°å€ å¯ä»¥è¦†ç›– target
      router: (req, env) => {
        return env.target;
      },
    },
    // å¯ä»¥æ·»åŠ æ›´å¤šç¯å¢ƒ
  ],
};
```

**envList**

envList çš„ä¸»é”®ç»„åˆä¸º name å’Œ port ã€‚è‹¥æ•°æ®å®Œå…¨ç›¸åŒï¼Œåˆ™åä¸€æ¡æ•°æ®ä¼šè¢«å¿½ç•¥ã€‚å¯¹äº port ç›¸åŒçš„æƒ…å†µï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œäº’æ–¥å¤„ç†ï¼Œå³å¯åŠ¨å…¶ä¸­ä¸€ä¸ªåï¼Œå†å°è¯•å¯åŠ¨å…¶ä»–ç›¸åŒ port çš„å®ä¾‹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å…³é—­å·²å¯åŠ¨çš„å®ä¾‹ï¼Œé¿å…å†²çªã€‚

**devServerList**

devServerList çš„ä¸»é”®ä¸º nameï¼Œç›¸åŒåˆ™å¿½ç•¥åä¸€ä¸ªã€‚

### å¼€å‘æœåŠ¡å™¨é…ç½®

è°ƒæ•´å¼€å‘æœåŠ¡å™¨ï¼Œå°†éœ€è¦ä»£ç†åˆ° API æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œè½¬å‘åˆ° åç½®ä»£ç†æœåŠ¡å™¨ã€‚

**webpack-dev-server**

```js
// webpack.config.js

module.exports = {
  devServer: {
    proxy: {
      "/two": "http://localhost:3099",
    },
  },
};
```

**vite**

```js
// vite.config.js
import { defineConfig } from "vite";

// https://vite.dev/config/
export default defineConfig({
  server: {
    proxy: {
      "/dev-manage-api": {
        target: "http://localhost:3099",
        changeOrigin: true,
      },
      "/simple": {
        target: "http://localhost:3099",
        changeOrigin: true,
      },
      "/two": {
        target: "http://localhost:3099",
        changeOrigin: true,
      },
    },
  },
});
```

### å¯åŠ¨

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ç®¡ç†æœåŠ¡å™¨ï¼š

```bash
npx envmange
```

æˆ–è€…é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼š

```bash
npx envmanage --config ./path/to/env.config.js
```

è®¿é—®ç®¡ç†é¡µé¢ [http://localhost:3099/](http://localhost:3099/) å¯¹å„ä¸ªä»£ç†æœåŠ¡è¿›è¡Œç®¡ç†ã€‚

### é…ç½®æ–‡ä»¶çƒ­æ›´æ–°

å¦‚æœéœ€è¦ä¿®æ”¹ç¯å¢ƒé…ç½®ï¼Œç›´æ¥ä¿®æ”¹ `env.config.js` æ–‡ä»¶ï¼Œå·¥å…·æ”¯æŒçƒ­æ›´æ–°ï¼Œä¿®æ”¹åæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆã€‚

## ä¾èµ–

- `express`: Web æ¡†æ¶ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†æœåŠ¡å™¨ã€‚
- `http-proxy-middleware`: ç”¨äºåˆ›å»ºä»£ç†ä¸­é—´ä»¶ï¼Œè½¬å‘è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚
- `chokidar`: ç”¨äºç›‘å¬é…ç½®æ–‡ä»¶çš„å˜åŒ–ï¼Œå®ç°çƒ­æ›´æ–°ã€‚
- `yargs`: ç”¨äºè§£æå‘½ä»¤è¡Œå‚æ•°ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestã€‚è¯·åœ¨æäº¤ä¹‹å‰é˜…è¯» [è´¡çŒ®æŒ‡å—](CONTRIBUTING.md)ã€‚

## ä½œè€…

- [Your Name](https://github.com/yourusername)

---

æ„Ÿè°¢ä½¿ç”¨ `EnvManage`ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ã€‚

[npm]: https://img.shields.io/npm/v/env-manage-plugin.svg
[npm-url]: https://npmjs.com/package/env-manage-plugin
[node]: https://img.shields.io/node/v/env-manage-plugin.svg
[node-url]: https://nodejs.org
